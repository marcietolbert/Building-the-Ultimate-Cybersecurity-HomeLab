# SEC, SOC, Malware Analysis VM Setup
Welcome to **Lab 00**, the first lab in the **Building the Ultimate Cybersecurity HomeLab** series. In this guided session, I will walk you through the steps to download and configure six distinct virtual machines that will be hosted on VMware Workstation Pro. Additionally, I will provide clear instructions on how to download and set up VMware Workstation Pro itself.

Before we begin the configuration process, let's first examine the logical structure of our lab environment. This visual representation will help you understand how the devices in this lab interact with one another. We will use Lucidchart, a user-friendly online diagramming tool, to create this logical diagram. 

Let’s get started!

## Logical Diagram



## Mandatory System Requirements
The mandatory system requirements for your host machine are as follows: 
- **RAM:** 32 GB (gigabytes) of RAM or **higher**
- **CPU:** 64-Bit 2.0+ GHz processor or **higher**
- **Disk:** 500 GB of SSD or **higher**

## Lab Environment
- **VMware Workstation Pro** (Hypervisor)
- **Kali Linux** (Attack Machine)
- **Metasploitable** (Vulnerable Target)
- **Ubuntu Client** (Workstation)
- **Ubuntu Server** (Wazuh | SIEM/Security Monitoring)
- **Security Onion** (Threat Hunting | Security Monitoring | Log Management)
- **FLARE VM** (Win10 | Reverse Engineering/Sandboxed Malware Analysis Machine)

## VMware Workstation Pro Download and Configuration
To kick off the lab, we will first install and configure VMware Workstation Pro, an application that enables us to create and manage multiple virtual machines on a single physical computer.

### Setup
- Go to the <a href="https://www.vmware.com/products/desktop-hypervisor/workstation-and-fusion">VMware Workstation Pro</a> download page and click *DOWNLOAD FUSION OR WORKSTATION*.
<img width="639" alt="4d0oQh7S3j" src="https://github.com/user-attachments/assets/803348d5-6f0b-47d9-9603-b81a5faa5264"/>
<br>
<br>

- A Broadcom account is required to download VMware Workstation Pro. Click the *LOGIN* button in the upper right corner of the page and select *REGISTER* to create an account.
<img width="732" alt="3x2eZNxHSy" src="https://github.com/user-attachments/assets/86744c8f-a5c2-49a9-8f57-5ba6e8b6d448"/>
<br>
<br>

- Complete the registration process.
<br>

- On the **Broadcom Support** page type VMware Workstation Pro into the search bar and hit *Enter*.
<img width="485" alt="aOahLVlGu0" src="https://github.com/user-attachments/assets/b57eecbc-548c-462d-91af-726dbb817f40"/>
<br>
<br>

- Click the first link provided in the search results.
<img width="574" alt="DuEF88txIt" src="https://github.com/user-attachments/assets/861b2621-70c3-4348-b5b3-24dbe46f1a23"/>
<br>
<br>

- On the **Download and License VMware Desktop Hypervisor** page scroll down to the **Resolution** section and click the VMware Workstation Pro download link.
<img width="485" alt="Ko0XGIcA50" src="https://github.com/user-attachments/assets/0c1ff92d-64ee-4fa9-8b86-0d72d8f2ca69"/>
<br>
<br>

- On the **Product Downloads** page select the download that corrlates to your host machines operating system, then select the latest version of VMware Workstation Pro to download.
<img width="946" alt="y4qkbIWONE" src="https://github.com/user-attachments/assets/49787bc4-4b5a-4b51-9298-b2a2a7311e59"/>
<br>
<br>
<img width="916" alt="2tdtvg6a5u" src="https://github.com/user-attachments/assets/50cd0729-5b7a-4650-9baa-5f2f6182216b"/>
<br>
<br>

- Click the *Terms and Conditions* link to view the product terms and conditions, then click the checkbox next to *I agree to the Terms and Conditions*. You are now able to click the download button towards the bottom right of the page.
<img width="951" alt="b8p6obhHKN" src="https://github.com/user-attachments/assets/132027d3-698b-4490-81c1-1ec37b9a1749"/>
<br>
<br>

- Complete any remaining prompts to finish downloading.
<br>

- Proceed with installing VMware Workstation Pro to your host machine using all of the default settings.
<img width="371" alt="VMware-workstation-full-17 6 3-24583834_HBubLwhhvV" src="https://github.com/user-attachments/assets/6e4e3843-d1ac-4301-a7ae-b10a1c890b03"/>
<br>
<br>

Now we need to change two of the default virtual network connections listed for VMware Workstation Pro. Go to *Edit > Virtual Network Editor*. Once the new pane appears, edit VMnet1 (host-only), VMnet8 (NAT), and the DHCP settings using the following steps:
<br>
<br>

- Click on *Change Settings*.
<img width="598" alt="FanQDiEhgc" src="https://github.com/user-attachments/assets/6d603160-99fa-48d5-811a-2fc3b2191751"/>
<br>
<br>

- Select the NAT (Network Address Translation) connection and change the subnet IP to 10.0.0.0, click *Apply* to submit the change.
<img width="473" alt="k32Vl1h0pt" src="https://github.com/user-attachments/assets/ffe3d5de-737e-43bf-af77-495e4a44e998"/>
<br>
<br>

- Next, click *DHCP Settings* and change the starting IP so that it ends in .10. The next machine added will have an IP address of 10.0.0.11 and each subsequent machine's IP address will increment by one after that. Click *Apply* to submit the change.
<img width="596" alt="ZjwESJw9rp" src="https://github.com/user-attachments/assets/d6c75ddb-6ee4-4215-8439-7a936a2babb8"/>
<br>
<br>
<img width="379" alt="5EkbLi7zsI" src="https://github.com/user-attachments/assets/bee764db-83be-462a-869c-3664aac8d190"/>
<br>
<br>

- Lastly, select the host-only network connection and change the starting IP for the connection to 172.16.0.0. Click *Apply* to submit the change, then click *Ok* to close the pane.
<img width="596" alt="P7sA84KkOC" src="https://github.com/user-attachments/assets/d2afe255-20c9-4f08-86c7-41ea766848e6"/>
<br>
<br>
  
*For more information on virtual network connection types, refer to the Concept Dive section at the end of this write-up.*

## Kali Linux Download and Configuration
Now that we have installed and configured VMware Workstation Pro, let's set up our first virtual machine: Kali Linux. Kali Linux is a Debian-based distribution specifically designed for penetration testing and ethical hacking. This operating system includes a comprehensive suite of pre-installed security tools, making it an ideal choice for simulating real-world cyberattacks and various security scenarios. These tools range from network analyzers to vulnerability scanners, all aimed at helping security professionals identify and address vulnerabilities effectively.

### Setup
Going forward, we need to unzip and install the files we download. If you don't already have it installed, visit <a href="https://www.7-zip.org"/>7-Zip</a>, click *Download*, and choose the .exe file that matches your operating system to install it.
<br>
<br>
<img width="786" alt="OsNvI3ssT9" src="https://github.com/user-attachments/assets/4e4db891-a7df-43d7-b67c-0f750b607ae2"/>
<br>
<br>

- Create a folder named **SecLab** on the host machine's **C:** drive, then create a subfolder named **ISO** to organize all future downloads.
<br>

- Go to the <a href="https://www.kali.org/"/>Kali Linux</a> website and click *Download*.

![FB3M2aKZy3](https://github.com/user-attachments/assets/38e5169b-a935-4e33-9149-1fbf22b6831e)
<br>
<br>

- On the **Choose your Platform** page select *Virtual Machines* to download a pre-configured virtual machine.
<img width="1217" height="513" alt="zzzPOZPPyP" src="https://github.com/user-attachments/assets/0aafef64-ef22-4dac-b182-074486ed01b4" />
<br>
<br>
<br>

- On the **Pre-built Virtual Machines** page, download the virtual machine that is compatible with your hypervisor. Since we have already configured and installed VMware Workstation Pro, you should download the first virtual machine. If you are using a different hypervisor, feel free to choose an alternative option.
<img width="1058" height="596" alt="KJcPBpFj7t" src="https://github.com/user-attachments/assets/bf076a18-1ae1-4207-923b-13a16ca67baf" />
<br>
<br>

- Move the Kali Linux .iso file into the **ISO** subfolder, and extract the file by right-clicking the Kali Linux folder and selecting *Show More > 7-Zip > Extract Here*.
<br>

- Rename the extracted file "Kali Linux".
<img width="724" height="354" alt="QRqS2q3fQO" src="https://github.com/user-attachments/assets/155c2297-c7b6-4313-88cd-eea8d781c16d" />
<br>
<br>

- Open the Kali Linux folder and double-click the file with the icon that looks like three sheets of paper to open it in VMware Workstation Pro.
<img width="724" height="354" alt="qlzmilas23" src="https://github.com/user-attachments/assets/eaf68c36-858e-44d7-9ce1-8a26d6e62a37" />
<br>
<br>

- Right-click the virtual machine to rename it to “Kali Linux”. Right-click on *My Computer*, select *New Folder*, and name it **SecLab**. Drag the Kali Linux machine into this folder.
<img width="311" height="125" alt="5qqPw6thVh" src="https://github.com/user-attachments/assets/7814a748-4ecb-450b-8f42-38c01c698e37" />
<br>
<br>

- Click the Kali Linux machine to select it.
<img width="1752" height="960" alt="9N6WIRxX6Q" src="https://github.com/user-attachments/assets/21912ba1-df33-4f97-af77-353fadc65a05" />
<br>
<br>

***Note:*** *In the main pane of this virtual machine, the username and password are listed in the **Description** section.*
<br>
<br>

- Now we need to change some settings for the virtual machine. Click on *Edit virtual machine settings*.
<img width="1752" height="960" alt="yHfI9cOZ6g" src="https://github.com/user-attachments/assets/784f1466-7f27-4fae-973d-5a68688d6534" />
<br>
<br>

- Change the memory to 8 GB while keeping the other default settings, then click *OK*.
<img width="563" height="534" alt="3Q0kZmL68y" src="https://github.com/user-attachments/assets/9efa74e5-f3d7-4752-968b-ddb05fd89519" />
<br>
<br>

- Start the Kali Linux machine by double-clicking its name in the library pane or by clicking the green play button next to *Power on this virtual machine*.
<img width="1752" height="960" alt="PPAS3AUuTx" src="https://github.com/user-attachments/assets/b67faf4d-52ea-4fa0-b6fb-a416793930ef" />
<br>
<br>

- If you get a pop-up that appears click *Ok* and wait for the machine to boot.
<br>
<br>

- If you remember, the username and password to log into the machine are "kali:kali". Use these credentials to log in.
<img width="387" height="218" alt="vmware_Ft6dBJqaAF" src="https://github.com/user-attachments/assets/903ffafc-7949-4cde-a679-892859ad7dfc" />
<br>
<br>

Let’s ensure that we can access the external network.
<br>
<br>

- Open a terminal session and ping Goggle by entering the command `ping 8.8.8.8`.
<img width="319" height="105" alt="kJ3wwazfck" src="https://github.com/user-attachments/assets/66d90229-367d-47c2-9089-c37cc7967989" />
<br>
<br>

If there are no lost packets, it means the virtual machines' network traffic successfully reached the external network and a Google server.
<img width="512" height="257" alt="Fez6g8oyr3" src="https://github.com/user-attachments/assets/c2de9f65-6906-4b0a-aa00-0ad16bc57847" />
<br>
<br>

Let's look at the IP address of this machine.

- Enter `ifconfig` into the terminal.
<img width="308" height="71" alt="YJySzGpMuM" src="https://github.com/user-attachments/assets/e950fd89-421b-435a-88af-bd6612bdf9fa" />
<br>
<br>

- Under inet we can see that the machine's IP address is 10.0.0.10. This confirms that the starting range we configured for the DHCP server successfully assigned the first machine we installed an address that ends in .10.
<img width="450" height="247" alt="Nd9BiK4UyF" src="https://github.com/user-attachments/assets/3380d3df-3414-46d1-bfb2-5c6cfe74b414" />
<br>
<br>

- Run the command `sudo apt update && sudo apt upgrade` to refreash and install the newest versions of all packages currently installed on the system.
<img width="518" height="162" alt="R09Y7imtb2" src="https://github.com/user-attachments/assets/db60ee65-b432-4f0a-bccd-8878a77c1269" />
<br>
<br>

- Minimize the machine.

- Take a snapshot of the current state of the machine by right-clicking the virtual machine in the library and navigating to *Snapshot > Take Snapshot*. Name the snapshot and add a description before clicking *Take Snapshot* to save.
<img width="260" height="167" alt="FF2jbzFFXK" src="https://github.com/user-attachments/assets/e0cb9eb4-1188-45d8-820a-91ae23670548"/>
<br>
<br>

Now let's reduce the resources allocated to the virtual machine so we can run multiple VMs simultaneously. The initial allocation was made to expedite the installation process.

- For the Kali VM, set the number of processors to 1 and the number of cores per processor to 1.

## Metasploitable Download and Configuration
Our next task is to download the Metasploitable 2 virtual machine. First, let’s clarify what Metasploitable 2 is. It is a deliberately vulnerable target machine designed to test common vulnerabilities. In our lab environment, it will serve as a device that can be attacked by our Kali Linux machine.

With that's said lets get to it!

### Setup
- Download the Metasploitable 2 virtual machine <a href="https://sourceforge.net/projects/metasploitable">here</a>.
<img width="538" height="367" alt="H0Lpckbkgv" src="https://github.com/user-attachments/assets/9ac838fe-a124-48a9-a5b0-e14865bfd005" />
<br>
<br>

- Extract the file. Move or copy the Metasploitable 2 folder into the *SecLab > ISO* folder we created earlier. Rename the folder “Meta”.
<img width="724" height="354" alt="P0yOuzfZKE" src="https://github.com/user-attachments/assets/b6716bc5-80ff-467e-89c1-fd5b176de719" />
<br>
<br>

- Open the **Meta** folder, then double-click the file with the icon that looks like three sheets of paper to open the Metasploitable 2 virtual machine in VMware Workstation Pro.
<img width="724" height="354" alt="2kHTf8J2Dc" src="https://github.com/user-attachments/assets/461246e3-3c1e-49ed-970f-92226f740114" />
<br>
<br>

- Move the virtual machine into the **SecLab** folder and rename the virtual machine “Meta”.
<img width="312" height="137" alt="MdeXL9JQ10" src="https://github.com/user-attachments/assets/56ce0ed8-3e65-4ba4-8e09-b5fa09f90ef3" />
<br>
<br>

*Remember that the default username and password for the virtual machine is msfadmin:msfadmin.*

- Click on *Edit virtual machine settings*.
<br>
<br>

- Click *Ok* to confirm and then power on the virtual machine.
<br>
<br>

- Click *Ok* for the first pop-up and select *I Moved It* for the second pop-up.
<br>
<br>

- Log into the machine using the provided username and password.
<br>
<br>

*Note: The username and password can also be found above the login prompt.*

- Check the machine's IP address, enter ifconfig at the command prompt, which ends with $. Look for inet, which will show 10.0.0.11 as your IP address.
<br>
<br>

- Now, let's test the connection to the Kali machine by entering the command: `ping 10.0.0.10`.
<br>
<br>

- Wait a couple of seconds before pressing *CTRL > c* to stop the ping.
<br>
<br>

- If packets sent successfully reach the Kali machine, then the two machines can communicate with each other.
<br>
<br>

*Note: You can specify the number of packets to send, eliminating the need to manually stop the ping.*

- Execute the command `ping -c 4 10.0.0.10`. This command instructs the shell to stop pinging after sending 4 ICMP ECHO_REQUEST packets and receiving 4 ECHO_RESPONSE packets.
<br>
<br>

- Finally, let's update and upgrade the machine. Enter the command `sudo apt update`, followed by `sudo apt upgrade -y`.
<br>
<br>

*Note: Sudo is used to run the command as the superuser, as elevated privileges are needed to update and upgrade the machine. The -y option will automatically respond with "yes" to any prompts that require a yes or no response when the shell executes the command.*

You can now shut down both the Kali Linux and Metasploitable machines.

## Ubuntu Client Download and Configuration
We will now be installing Ubuntu Desktop, which is a user-friendly, free, and open-source operating system.

### Setup
- Go to Ubuntu’s website <a href="https://ubuntu.com/download/desktop">here</a> and click Download Ubuntu.
<br>
<br>

- To download the latest LTS version of Ubuntu desktop, click the green download button on the download page.
<br>
<br>

- Save the Ubuntu desktop file to the *SecLab > ISO* folder.
<br>
<br>

- Back in VMware Workstation Pro click *Home > Create a New Virtual Machine*.
<br>
<br>

- In the **New Virtual Machine** wizard, follow these steps:
    - Ensure that **Typical (Recommended)** is selected, then click *Next*.
    - Click *Browse* under the **Installer disk image file** section and select the Ubuntu desktop .iso file located in the *SecLab > ISO* folder, then click *Open* and proceed by clicking *Next*.
    - For the Full Name, enter "Ubuntu Client." Use "Ubuntu" as the username and choose a simple password of your choice. Click *Next* to continue.
    - Remove “64-bit” from the virtual machine name so that it simply reads "Ubuntu," then click *Next*.
    - Change the maximum disk size to 100 GB and click *Next*.
<br>
<br>

- Review the settings, then click on *Customize Hardware*.
<br>
<br>

- Adjust the memory to 8 GB and set the processor to 2 cores, then click *Close*.
<br>
<br>

- Review the settings once more, and then click *Finish*.
<br>
<br>

- The installation will now start automatically. Once the screen prompts you to choose your language, select the following settings:
    - **Language:** English (or your preferred language) and click *Next*.
    - **Accessibility:** Click *Skip*.
    -**Keyboard Layout:** English (or your preferred language) and click *Next*.
    - **Connect to the Internet:** Use a wired connection and click *Next*.
    - **Updates:** Click *Skip*.
    - **What do you want to do with Ubuntu:** Select *Install Ubuntu* and click *Next*.
    - **How would you like to install Ubuntu:** Choose *Interactive Installation* and click *Next*.
    - **What apps would you like to install to start with:** Keep the default selection and click *Next*.
    - **Install Recommended Proprietary Software:** Leave this option blank and click *Next*.
    - **How do you want to install Ubuntu:** Select *Erase disk and install Ubuntu" and click "Next.*
<br>
<br>

- Create an account, by following these steps:
    - **Enter your name:** Ubuntu Client.
    - **Provide your computer's name:** Ubuntu.
    - **Set your username:** ubuntu client.
    - **Choose a simple password of your choice:** ******
    - Ensure that the option to **Require my password to log in** is selected.
    - Click *Next*.
    - Select your time zone, then click *Next*.
    - Review your choices (if desired), and then click *Install*.
<br>
<br>

- Click *Next* and *Finish* on all pages of the **Welcome to Ubuntu** dialog to close the window.
<br>
<br>

- Right-click the desktop and select *Terminal*. Then, right-click the Terminal window and choose *Pin to Dash*.
<br>
<br>

- Enter the command 'ip a' into the command prompt. We can see under **inet** that the DHCP server has assigned this workstation an IP address of 10.0.0.12 and a subnet mask of /24.
<br>
<br>

We used `ip a` instead of `ifconfig` because `ifconfig` is not natively installed.

- To install the ifconfig tool type `sudo apt install net-tools`. Elevated privileges are required to install software, which is why we prefix the command with sudo.
<br>
<br>

- Now run the ifconfig command.
<br>
<br>

- As with the previous machines, ping Google to ensure you have internet connectivity: `ping -c 4 8.8.8.8`.
<br>
<br>

- To complete the update process, use the following commands: `sudo apt update` to refresh the package list, followed by `sudo apt upgrade -y` to upgrade the installed packages automatically.
<br>
<br>

- Rename the machine to "Ubuntu Client." Then, move the Ubuntu machine into the **SecLabs"** folder in the library pane.

## Ubuntu Server (Wazuh) Download and Configuration
The next virtual machine we will be working on is Ubuntu Server with Wazuh. Ubuntu Server is a specialized version of the Ubuntu operating system designed for server use. Wazuh is a free and open-source security platform used for various purposes, including threat detection, security monitoring, and compliance. It offers capabilities such as log analysis, intrusion detection, and vulnerability detection.

We will first install Ubuntu Server and then proceed to install Wazuh.

### Server Setup
- Go back to the tab where you have the Ubuntu Desktop download open and click.
<br>
<br>

- Please scroll down to the **Alternative Downloads** section and download the 20.04.6 LTS version.
<br>
<br>

- Save the file to the *SecLab > ISO* folder.
<br>
<br>

- Go back to VMware Workstation Pro, click on *Home*, and select **Create a New Virtual Machine**.
<br>
<br>

- In the **New Virtual Machine Wizard**, follow these steps: 
    - Ensure that *Typical (Recommended)* is selected, then click *Next*.
    - Click *Browse* under the **Installer disk image file** section, and select the Ubuntu live server .iso file located in the *SecLab > ISO* folder. Click *Open*, then "Next."
    - Enter "Wazuh" as the Virtual Machine Name, change the Maximum disk size to 200 GB, and click *Next*.
<br>
<br>

- Review the settings and then click on *Customize Hardware*.
<br>
<br>

- Change the memory to 16 GB and the processor to 2 cores, then click *Close*.
<br>
<br>

- Review the settings once more, taking into account the new additions, then click *Finish*.
<br>
<br>

- The installation will now begin automatically. Please click *OK* for any pop-up messages that appear.
<br>
<br>

You will now need to use your keyboard to navigate.
<br>
<br>

- Make sure that **Try or Install Ubuntu Server** is already selected, then press *Enter*.
<br>
<br>

- On the welcome screen, follow these steps:
    - **Select Language**: Choose *English* or your preferred language and press *Enter*.
    - **Installer Update Available**: Press *Enter.*
    - **Keyboard Configuration**: Press *Enter*.
    - **Choose Type of Install**: Press *Enter*.
    - **Network Connection**: Press *Enter*.
    - **Configure Proxy Server**: Press *Enter.*
    - **Configure Ubuntu Archive Mirror**: Press *Enter*, then use the arrow keys to navigate down to *Continue* and press *Enter*.
    - **Guided Storage Configuration**: Press Tab until you can select *Done*, then press *Enter.*
    - **Storage Configuration**: Ensure *Done* is highlighted, then press *Enter*. Next, press *Tab* to navigate to *Continue* and press *Enter*.
<br>
<br>

- For the profile setup, enter the following details: **Your Name** - Wazuh Server, **Your Server's Name** - wazuh, **Username** - wazuh, and a simple password. Press *Tab* to select Done, then press *Enter*.
<br>
<br>

- On the **Upgrade to Ubuntu Pro** screen, use the *Tab* key to navigate to *Done* and then press *Enter*.
<br>
<br>

- On the **Install SSH** page, navigate down to *Done* and press *Enter* to select it.
<br>
<br>

- On the **Featured server snaps** page tab down to *Done* and press *Enter*.
<br>
<br>

- Once the installation is complete, press the *Tab* key to navigate to *Reboot* and then press *Enter*.
<br>
<br>

- After the reboot is complete, press *Enter* to access the login page and enter your username and password.
<br>
<br>

ifconfig is not natively installed on the Ubuntu Server, like it wasn’t on the client we installed previously. Let’s install it now.

- Type `sudo apt install net-tools`. Remember that elevated privileges are necessary for installations, which is why we use sudo.
<br>
<br>

- Type `ifconfig` into the command prompt and note the IP address, as you will need it to access the server shortly.
<br>
<br>

- To complete the process, update the machine by using the following commands: `sudo apt update` and `sudo apt upgrade -y`.
<br>
<br>

- On the **Daemons using outdated libraries** window, press *Tab* to select *Ok*, then press *Enter*. After that, press *Tab* again to select *Ok* and press *Enter*.

### Wazah Setup
- To download Wazuh from the Wazuh website, enter the following command into the command prompt: `curl -sO https://packages.wazuh.com/4.8/wazuh-install.sh`.

- Enter the command `ls` into the command prompt to confirm that Wazuh has been installed in the current working directory.

- To install Wazuh on the server, enter the following command: 

```
sudo bash ./wazuh-installation.sh -a
``` 

This command will initiate the installation process.

After the installation is complete, you will receive a username and password. Let’s change both of them.

- To download the file, use the following command: 

```bash
curl -so wazuh-passwords-tool.sh https://packages.wazuh.com/4.8/wazuh-passwords-tool.sh
```

*Note: The last command that was run is saying go download the Wazuh password tool from the proceeding web addressNote: The last command executed instructs to download the Wazuh password tool from the web address provided.*

- Use the command `ls` to check if the tool has been downloaded to the current working directory.

- To execute the script, run the following command:

```bash
sudo bash wazuh-passwords-tools.sh -u admin -p Secret3Pass4w*rd
``` 

This command uses `sudo` to run the script with administrative privileges, specifying the username as "admin" and the password as "Secret3Pass4w*rd".

We changed the password due to its length. The original password was very long, which made it easier to enter incorrectly. To save time and simplify the process, we needed to change it.

Once the password has been updated, we need to update the Wazuh Manager as instructed.

- To restart the Wazuh manager, run the following command: 

```bash
sudo systemctl restart wazuh-manager
```

- Let's check the status of the Wazuh manager. Please run the command: `sudo systemctl status wazuh-manager`.

The output should indicate that the Wazuh Manager service is both active and running.

- Press *q* to exit.

Now, let's attempt to access the Wazuh Manager from the Ubuntu client.

- Return to the Ubuntu client and log in if logged out.

- Launch the Firefox browser.

- To proceed, enter 10.0.0.13 in the search bar. On the warning page, click the *Advanced* button, then select *Accept the Risk and Continue*.

- Log in using the admin username and the new password that we created.

- Click *Save* to store the password in your browser.

*Note:** *This practice should never be conducted in real-life scenarios, as an attacker could easily access all of your stored passwords if your system is compromised. However, doing this in our lab environment is acceptable, as it simplifies certain processes for us.*

Next, we need to install the Wazuh agent on the Ubuntu client.

- Click the *Add Agent* link.

- On the **Deploy New Agent** page, select the following: choose the package to download and install on your system - *Linux DEB amd64*. The server address should already be populated (10.0.0.13). In Optional Settings, assign an agent name - Ubuntu.

- You are now provided with command to download and install the agent, copy it and run it in the terminal's shell, ensuring you prepend `sudo` before pasting the command.

- Enter the password for the Ubuntu client when prompted.

- After installing the agent, return to Firefox and copy the final command to start the agent.

- Execute the command in the terminal shell, ensuring to prepend `sudo`.

- The command will reload the daemon, enable the agent, and start it.

- Check the status of the Wazuh agent to ensure it is enabled, active, and running by executing the command: `systemctl status wazuh-agent`.

- Press *q* to exit.

- Go back to Firefox and click on *Close*.

- You should now see that one agent is currently active.

You can also click on the W to access the Wazuh dashboard, which is another place to verify that the agent has been installed.

- In the VMware Workstation Pro Library pane, change the machine's name to Wazuh Manager and move it into the SecLab folder.

- ***Note:*** *If you cannot log in to the Wazuh manager, check if the service is running and restart it if necessary.*

- Turn off both the Ubuntu Client and the Wazuh Manager.

## Security Onion Download and Configuration

## FLARE VM Download and Configuration


### Setup
- Visit the official webpage to download Windows 10.

- Click on *Download Now*.

- Save the file to your **Downloads** folder, then double-click it to open.

- The process of creating an ISO file has begun. Click *Accept* to agree to the terms and the licensing agreement, then select *Create installation media* and click *Next*.

- Select your language - English or your preferred language. Choose the media type - ISO file, then click *Next*.

- When prompted, save the file in the *SecLabs > ISO* folder, then click *Next*.

- Open VMware Workstation Pro and select *Create a New Virtual Machine*.

- In the **New Virtual Machine Wizard**, follow these steps:

    - Ensure that *Typical (Recommended)* is selected, then click *Next*.
    - Click *Browse* under the *Installer disk image file*, locate the Windows 10 .iso file in the SecLab > ISO folder, and click *Open*. Then click *Next*.
    - Enter "Windows 10" as the virtual machine name, and click *Next*.
    - Change the maximum disk size to 150 GB and click *Next*.
 
- Review the settings and then click on *Customize Hardware*.

- Adjust the following settings: **Memory** - 16 GB, **Cores per processor** - 2, **Network Adapter** - keep as NAT until FLARE VM is installed; then it will be switch to host-only. Click *Close*.

- Review the settings once more, including the new additions, then click *Finish*.

- When Windows begins to boot up, press any key to start from the DVD drive.

- Follow these steps for the Windows Setup:

1. When you reach the Windows Setup screen, click "Next."
2. Click "Install Now."
3. To activate Windows, select "I don’t have a product key."
4. Choose the operating system you want to install by selecting "Windows 10 Pro," then click "Next."
5. Review and agree to the license terms by clicking "I agree," then click "Next."
6. When asked which type of installation you want, select "Custom Installation," and then click "Next."

Windows will begin the installation process.

- To set up Windows, follow these steps:

1. **Region**: Select "United States" (or your appropriate region).
2. **Keyboard Layout**: Choose "US" (or your preferred layout) and click "Next."
3. **Second Keyboard Layout**: Click "Skip."
4. **How would you like to set up?**: Select "Set up for personal use" and click "Next."
5. **Let’s add your account**: Click "Offline account."
6. **Next screen**: Click "Limited experience."
7. **Who’s going to use this PC?**: Type "Flare_vm" and click "Next."
8. **Create a password**: Enter a password of your choice and click "Next."
9. **Confirm password**: Re-enter your password and click "Next."
10. **Security questions**: Choose three security questions and provide corresponding answers, then click "Next."
11. **Next screen**: Click "Not now."
12. **Choose privacy settings for your device**: Deselect all options and click "Accept."
13. **Next screen**: Click "Skip."
14. **Cortana**: Click "Not now."

- Once the Windows installation is complete, click on the Windows logo, type “cmd” into the search bar, and press *Enter*.

- Type `ipconfig` to check the IP address. It should be listed under "IPv4 Address" as 10.0.0.14.

- Perform a ping test to Google to check for internet connectivity.

- Press Ctrl + C to stop the ping command.

We now need to disable the firewall.

- Right-click on the Windows logo and select *Settings*. Next, click on *Update & Security*.

- Click *Pause Updates* for 7 days, then close the window.

- Type “Windows Security" in the search bar at the bottom of your screen and open the application.

- Click on *Manage Settings* located under the *Virus & Threat Protection Settings*.

- Disable Real-time Protection and then click *Yes* on the pop-up window.

- Now turn off *Cloud-delivered protection* and *Automatic sample submission*. Then close the window.

Now permanently Disable some settings using Group Policy.

We now need to permanently disable certain settings using Group Policy.

- Right-click on the Windows logo and select *Run*.

- Type "gpedit.msc" and press *Enter*.

- We are now in the Local Group Policy Editor. Let’s permanently disable Windows Update. Under **Computer Configuration**, expand *Administrative Templates > Windows Components > Windows Update* and open *Configure Automatic Updates* located in the right pane.

- Click the *Disabled* satellite button, then click *Apply* followed by *OK*.

- Close the window.

Let’s permanently disable Windows real-time protection.

- Follow the same process as before to open the Group Policy Editor again.

- Expand **Computer Components**, then go to *Administrative Templates > Windows Components > Microsoft Defender Antivirus*, and open the option to *Turn Off Microsoft Defender Antivirus*.

- Click the *Enabled* satellite button, then click *Apply* and finally click *OK*.

- Return to the main pane to disable Microsoft Defender Antivirus by opening the Real-time Protection folder.

- Open turn off Realtime protection, on the *Enabled* satellite button, then click *Apply* and *Ok*.

- Close the window.

Now we need to restart the machine.

- Right-click the Windows logo, then select *Shut down or sign out*, and choose *Restart*.

- After the reboot, log in to the virtual machine.

- Open Microsoft Edge.

- After rebooting, log in to the virtual machine.

- Click on the first link displayed.

- Scroll down to find the section on Flare VM installation.

- To open PowerShell, right-click the Windows logo and search for *PowerShell* in the search bar.

- Right-click on PowerShell and choose *Run as Administrator*.

- When the pop-up appears click *Yes*.

Now we need to grab the file path for the Flare_vm user desktop.

- Open **File Explorer**, click on *This PC*, then double-click on the C drive. Open the following folders: *Users > Flare_vm > Desktop*.

- Copy the path for this directory, and then close the window.

- In PowerShell, type `cd`, then paste the path we copied and press *Enter*.

- Now that we are in the desktop directory for the Flare_vm user, let's download the Flare VM file.

- Go back to Microsoft Edge and copy the provided PowerShell script for installation.

- Copy the script, paste it into PowerShell, and then press *Enter* to execute it.

The file should now be downloaded. Minimize your open windows to view the desktop where you should see the Flare VM Installer.

- Copy the unblock installation command from GitHub and paste it into PowerShell. Then press *Enter* to execute the command.

- Copy the command that enables script execution from GitHub, paste it into PowerShell, then press *Enter* to run the command.

- Type `.\install.ps1` and press *Enter* to run the Flare_vm script located on the desktop.

- Respond with "yes" to the question about taking a snapshot of this VM, then press *Enter*.

- ￼Enter the password for the virtual machine.

- During the Flare VM installation, a welcome window will appear. Click *Ok* to accept the package installations.

- After the installation is complete, a Notepad window will open, displaying information about the installed packages. Close the window.

- To exit the command prompt, press *Enter*.

- In the VMware Workstation Pro Library pane, rename the machine to "Flare VM" and move it into the **SecLab"** folder.

- You can now turn off the machine.

- Finally, in the VMware Workstation Pro Library, click on the SecLab folder, then select the Flare VM machine and double-click on the Flare VM in the right pane.

Let's make some final adjustments to the Flare VM settings to lower resource usage, allowing us to run multiple machines simultaneously.

- Click to edit the virtual machine settings, then configure the following: Memory - 4 GB, number of processors: 1.

- Finally, change the Network Adapter setting from NAT to host-only to ensure the VM remains isolated.

- Click *Ok*.


## Concept Dive
The concept dive section aims to provide a more in-depth examination of topics that deserve closer scrutiny. This section will spotlight areas that would benefit from thorough research and knowledge checks, as these are concepts that every cybersecurity professional should understand.

### Virtual Machine Connection Types
Let’s take a moment to explore the different types of network connections available for virtual machines. If you recall VMware Workstation Pro's Virtual Network Editor, we encountered three network connection types: bridged, host-only, and NAT (Network Address Translation).

**Bridged Mode -** When a virtual machine is using a bridged connection:
- The virtual machine obtains its IP address from the LAN router's DHCP server, allowing it to function as a separate physical machine on the network.
- The virtual machine is directly connected to the physical network, enabling it to communicate with other devices on the network and access the Internet.
- The host machine's network adapter serves as a bridge, enabling the virtual machine's network traffic to flow from the virtualized environment to the physical network and subsequently to the external network (Internet).
- Used when the VM requires full network access and is directly addressable from the physical network's subnet.

**NAT (Network Address Translation) Mode -** When a virtual machine is using a NAT connection:
- The virtual machine is assigned a unique IP address by the hypervisor's DHCP server.
- To access the external network, Network Address Translation (NAT) is used to convert the virtual machine's IP address to the public IP address of the host machine. The host machine's public IP address is recorded in the host's NAT table. This setup enables the host machine to function as a router.
- NAT conceals the VM's IP address. The VM uses the host's public IP address on the Internet, making it seem as though network traffic originates from the host machine rather than the virtual machine.

**Host-Only Mode -** When a virtual machine is using a host-only connection:
- The virtual machine is isolated which establishes a private connection with the host, thereby only allowing communication with the host and other virtual machines in host-only mode.
- A secure sandboxed environment is established for malware analysis and reverse engineering.
- The virtual machine cannot access the external network (Internet) because it is isolated. Thus, it has no network access.
  
Understanding these connection types can help you choose the best option for your specific virtual machine requirements.
